{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\user\\\\Desktop\\\\Shaji Project\\\\frontEnd\\\\src\\\\core\\\\Cod.js\";\nimport React, { useState, useEffect } from 'react';\nimport \"./Bill.css\";\nimport { v4 as uuidv4 } from 'uuid';\nimport { loadCart, loadCartBill, findQty } from './helper/cartHelper';\nimport { isAutheticated } from \"../auth/helper/index\";\nimport { confirmOrders } from './helper/coreapicalls';\nimport { Redirect } from 'react-router-dom';\nimport { getUserAddress } from \"./helper/locationhelper\";\nimport { isAuthenticated } from '../../../backend/controllers/auth';\nexport default function Cod() {\n  const [cartproducts, setcartproducts] = useState([]);\n  const [reload, setReload] = useState(false);\n  const [totalcount, setTotalcount] = useState(0);\n  const [redireact, setredireact] = useState(false);\n  const [totalPrice, setTotalPrice] = useState(0);\n  const [loading, setLoading] = useState(false);\n  const [thisProduct, setthisProduct] = useState(0);\n  const [thisNameProducts, setthisNameProducts] = useState(0);\n  const [userids, setuserids] = useState(\"\");\n\n  const loadAllUserDatas = () => {\n    if (userids) {\n      getAllDataOfUser(userids).then(res => {\n        console.log(res);\n      }).catch(err => {\n        console.log(err);\n      });\n    }\n  };\n\n  useEffect(() => {\n    setcartproducts(loadCart());\n    setthisProduct(loadCartBill());\n    setthisNameProducts(loadCartBill());\n    autoCountBtn();\n    setuserids(isAuthenticated.user._id);\n  }, [reload]);\n  const [latitude, setLatitude] = useState(\"\");\n  const [longitude, setLongitude] = useState(\"\");\n  const [location, setlocation] = useState(0);\n\n  const locationUser = event => {\n    setlocation(event.target.value); //Location done\n  };\n\n  const getGLocation = () => {\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(getCoordinates, handleLocationError);\n    } else {\n      alert(\"Geolocation is not supported by this browser.\");\n    }\n  };\n\n  const getCoordinates = position => {\n    console.log(position.coords.latitude);\n    setLatitude(position.coords.latitude);\n    console.log(position.coords.longitude);\n    setLongitude(position.coords.longitude);\n  };\n\n  const autoCountBtn = () => {\n    let cart = [];\n    let TCOUNT = 0;\n    let TOTAL_PRICE = 0;\n\n    if (typeof window !== undefined) {\n      if (localStorage.getItem(\"cart\")) {\n        cart = JSON.parse(localStorage.getItem(\"cart\"));\n      }\n\n      cart.map((PRODUCT, INDEX) => {\n        if (PRODUCT != null) {\n          TCOUNT = TCOUNT + 1;\n          TOTAL_PRICE = TOTAL_PRICE + PRODUCT.price;\n        }\n      });\n      setTotalcount(TCOUNT);\n      setTotalPrice(TOTAL_PRICE);\n      TCOUNT = 0;\n    }\n  };\n\n  const userId = isAutheticated().user;\n  const token = isAutheticated().token;\n\n  const isRedirectHome = () => {\n    if (redireact) {\n      return /*#__PURE__*/React.createElement(Redirect, {\n        to: \"/\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 20\n        }\n      });\n    }\n  };\n\n  const confirmOrder = event => {\n    event.preventDefault();\n    setLoading(true);\n    const PRODUCTS = loadCartBill();\n    console.log(\"S o \", PRODUCTS);\n    const names = contQty(PRODUCTS);\n    console.log(\"S o  names \", names);\n    const price = contPrice(PRODUCTS);\n    console.log(\"S o  price \", price);\n    localStorage.setItem(\"orderID\", uuidv4());\n    console.log(\"location : \", location);\n    console.log(\"userId : \", userId, token);\n    console.log(\"totalPrice : \", totalPrice);\n    console.log(\"cartproducts : S o \", cartproducts);\n    const ORDERID = localStorage.getItem(\"orderID\");\n    confirmOrders({\n      PRODUCTS,\n      names,\n      cartproducts,\n      price,\n      location,\n      totalPrice,\n      userId,\n      token\n    }, userId, token, ORDERID).then(responce => {\n      console.log(\"resdd . . . \", responce);\n      console.log(\"PRODUCTS : \", PRODUCTS);\n      PRODUCTS.map((pName, index) => {\n        console.log(\"pNAme\", pName);\n        window.localStorage.removeItem(pName);\n      });\n      window.localStorage.removeItem(\"cart\");\n      window.localStorage.removeItem(\"orderID\");\n      setredireact(true);\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n\n  const isLoading = () => {\n    if (loading) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        class: \"spinner-border text-warning\",\n        role: \"status\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 22\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        class: \"sr-only\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 17\n        }\n      }, \" Loading... \"), \" \");\n    }\n  };\n\n  const handleLocationError = error => {\n    switch (error.code) {\n      case error.PERMISSION_DENIED:\n        alert(\"User denied the request for Geolocation.\");\n        break;\n\n      case error.POSITION_UNAVAILABLE:\n        alert(\"Location information is unavailable.\");\n        break;\n\n      case error.TIMEOUT:\n        alert(\"The request to get user location timed out.\");\n        break;\n\n      case error.UNKNOWN_ERROR:\n        alert(\"An unknown error occurred.\");\n        break;\n\n      default:\n        alert(\"An unknown error accurder type ur address manually\");\n    }\n  };\n\n  const contQty = product => {\n    let cart = [];\n    let yy = [];\n    console.log(\"--->>> y product \", product);\n    let TOTOAL = 0;\n\n    if (typeof window !== undefined) {\n      if (localStorage.getItem(\"cart\")) {\n        cart = JSON.parse(localStorage.getItem(\"cart\"));\n        product.map((pro, I) => {\n          cart.map((cpor, cI) => {\n            if (cpor != null && pro === cpor.name) {\n              TOTOAL = TOTOAL + 1;\n            }\n          });\n          yy.push(TOTOAL);\n          TOTOAL = 0;\n        });\n      }\n    }\n\n    return yy;\n  };\n\n  const contPrice = product => {\n    let cart = [];\n    let yy = [];\n    let curentProduct = [];\n    console.log(\"--->>> y product \", product);\n    let TOTOAL = 0;\n\n    if (typeof window !== undefined) {\n      if (localStorage.getItem(\"cart\")) {\n        cart = JSON.parse(localStorage.getItem(\"cart\"));\n        product.map((pro, I) => {\n          cart.map((cpor, cI) => {\n            if (cpor != null && pro === cpor.name) {\n              TOTOAL = TOTOAL + 1;\n              yy.push(cpor.price);\n            }\n          });\n          TOTOAL = 0;\n        });\n      }\n    }\n\n    curentProduct = [...new Set(yy)];\n    return curentProduct;\n  };\n\n  const shoemap = () => {\n    if (latitude && longitude) {\n      const loc = {\n        \"latitude\": latitude,\n        \"longitude\": longitude\n      };\n      getUserAddress(loc).then(res => {// console.log(res);\n      }).catch(err => {// console.log(err);\n      });\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 14\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 9\n    }\n  }, \" COD \"), \" \", /*#__PURE__*/React.createElement(\"h4\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 25\n    }\n  }, \" \", JSON.stringify(latitude), \" \", JSON.stringify(longitude), \" \"), \" \", /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 80\n    }\n  }, \" \", shoemap(), \" \"), \" \", /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container codbox\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    class: \"alert alert-primary\",\n    role: \"alert\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 9\n    }\n  }, \"We are currently available in \", /*#__PURE__*/React.createElement(\"a\", {\n    href: \"#\",\n    class: \"alert-link\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 39\n    }\n  }, \" Malumichampatti \"), \". And we can do delivery !! \"), \" \", /*#__PURE__*/React.createElement(\"form\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    class: \"form-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 9\n    }\n  }, \" Your Address \"), \" \", /*#__PURE__*/React.createElement(\"input\", {\n    placeholder: \"Enter the address\",\n    onChange: e => {\n      locationUser(e);\n    },\n    type: \"text\",\n    class: \"form-control\",\n    required: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 40\n    }\n  })), \" \", isRedirectHome(), \" \", isLoading(), \" \", /*#__PURE__*/React.createElement(\"button\", {\n    onClick: confirmOrder,\n    type: \"submit\",\n    class: \"btn btn-primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 52\n    }\n  }, \" Confirm Address \"), \" \", /*#__PURE__*/React.createElement(\"button\", {\n    onClick: getGLocation,\n    type: \"submit\",\n    class: \"btn btn-primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 64\n    }\n  }, \" Confirm Address \"))), \" \");\n}","map":{"version":3,"sources":["C:/Users/user/Desktop/Shaji Project/frontEnd/src/core/Cod.js"],"names":["React","useState","useEffect","v4","uuidv4","loadCart","loadCartBill","findQty","isAutheticated","confirmOrders","Redirect","getUserAddress","isAuthenticated","Cod","cartproducts","setcartproducts","reload","setReload","totalcount","setTotalcount","redireact","setredireact","totalPrice","setTotalPrice","loading","setLoading","thisProduct","setthisProduct","thisNameProducts","setthisNameProducts","userids","setuserids","loadAllUserDatas","getAllDataOfUser","then","res","console","log","catch","err","autoCountBtn","user","_id","latitude","setLatitude","longitude","setLongitude","location","setlocation","locationUser","event","target","value","getGLocation","navigator","geolocation","getCurrentPosition","getCoordinates","handleLocationError","alert","position","coords","cart","TCOUNT","TOTAL_PRICE","window","undefined","localStorage","getItem","JSON","parse","map","PRODUCT","INDEX","price","userId","token","isRedirectHome","confirmOrder","preventDefault","PRODUCTS","names","contQty","contPrice","setItem","ORDERID","responce","pName","index","removeItem","isLoading","error","code","PERMISSION_DENIED","POSITION_UNAVAILABLE","TIMEOUT","UNKNOWN_ERROR","product","yy","TOTOAL","pro","I","cpor","cI","name","push","curentProduct","Set","shoemap","loc","stringify","e"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\r\nimport \"./Bill.css\"\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\nimport { loadCart, loadCartBill, findQty } from './helper/cartHelper';\r\nimport { isAutheticated } from \"../auth/helper/index\";\r\nimport { confirmOrders } from './helper/coreapicalls';\r\nimport { Redirect } from 'react-router-dom';\r\nimport { getUserAddress } from \"./helper/locationhelper\"\r\nimport { isAuthenticated } from '../../../backend/controllers/auth';\r\nexport default function Cod() {\r\n    const [cartproducts, setcartproducts] = useState([]);\r\n    const [reload, setReload] = useState(false);\r\n    const [totalcount, setTotalcount] = useState(0);\r\n    const [redireact, setredireact] = useState(false);\r\n\r\n    const [totalPrice, setTotalPrice] = useState(0);\r\n    const [loading, setLoading] = useState(false);\r\n    const [thisProduct, setthisProduct] = useState(0);\r\n    const [thisNameProducts, setthisNameProducts] = useState(0);\r\n    const [userids, setuserids] = useState(\"\");\r\n\r\n\r\n    const loadAllUserDatas = () => {\r\n        if (userids) {\r\n            getAllDataOfUser(userids).then(res => {\r\n                    console.log(res);\r\n                })\r\n                .catch(err => {\r\n                    console.log(err);\r\n                })\r\n        }\r\n    }\r\n    useEffect(() => {\r\n        setcartproducts(loadCart());\r\n        setthisProduct(loadCartBill())\r\n        setthisNameProducts(loadCartBill());\r\n        autoCountBtn()\r\n        setuserids(isAuthenticated.user._id)\r\n    }, [reload]);\r\n    const [latitude, setLatitude] = useState(\"\");\r\n    const [longitude, setLongitude] = useState(\"\");\r\n\r\n    const [location, setlocation] = useState(0)\r\n    const locationUser = event => {\r\n        setlocation(event.target.value) //Location done\r\n    }\r\n\r\n    const getGLocation = () => {\r\n        if (navigator.geolocation) {\r\n            navigator.geolocation.getCurrentPosition(getCoordinates, handleLocationError);\r\n        } else {\r\n            alert(\"Geolocation is not supported by this browser.\");\r\n        }\r\n    }\r\n    const getCoordinates = (position) => {\r\n        console.log(position.coords.latitude)\r\n        setLatitude(position.coords.latitude)\r\n        console.log(position.coords.longitude)\r\n        setLongitude(position.coords.longitude)\r\n\r\n    }\r\n    const autoCountBtn = () => {\r\n        let cart = [];\r\n        let TCOUNT = 0;\r\n        let TOTAL_PRICE = 0;\r\n\r\n        if (typeof window !== undefined) {\r\n            if (localStorage.getItem(\"cart\")) {\r\n                cart = JSON.parse(localStorage.getItem(\"cart\"));\r\n            }\r\n\r\n            cart.map((PRODUCT, INDEX) => {\r\n                if (PRODUCT != null) {\r\n                    TCOUNT = TCOUNT + 1;\r\n                    TOTAL_PRICE = TOTAL_PRICE + PRODUCT.price;\r\n                }\r\n            })\r\n            setTotalcount(TCOUNT)\r\n            setTotalPrice(TOTAL_PRICE);\r\n\r\n            TCOUNT = 0\r\n        }\r\n    }\r\n    const userId = isAutheticated().user;\r\n    const token = isAutheticated().token;\r\n    const isRedirectHome = () => {\r\n        if (redireact) {\r\n            return <Redirect to = \"/\" / >\r\n        }\r\n    }\r\n    const confirmOrder = (event) => {\r\n        event.preventDefault();\r\n        setLoading(true)\r\n        const PRODUCTS = loadCartBill();\r\n        console.log(\"S o \", PRODUCTS);\r\n        const names = contQty(PRODUCTS)\r\n        console.log(\"S o  names \", names);\r\n        const price = contPrice(PRODUCTS)\r\n        console.log(\"S o  price \", price);\r\n        localStorage.setItem(\"orderID\", uuidv4());\r\n\r\n        console.log(\"location : \", location);\r\n        console.log(\"userId : \", userId, token);\r\n        console.log(\"totalPrice : \", totalPrice);\r\n        console.log(\"cartproducts : S o \", cartproducts);\r\n        const ORDERID = localStorage.getItem(\"orderID\");\r\n\r\n        confirmOrders({ PRODUCTS, names, cartproducts, price, location, totalPrice, userId, token }, userId, token, ORDERID)\r\n            .then((responce) => {\r\n                console.log(\"resdd . . . \", responce);\r\n                console.log(\"PRODUCTS : \", PRODUCTS);\r\n\r\n                PRODUCTS.map((pName, index) => {\r\n                    console.log(\"pNAme\", pName);\r\n                    window.localStorage.removeItem(pName);\r\n\r\n\r\n                })\r\n                window.localStorage.removeItem(\"cart\");\r\n                window.localStorage.removeItem(\"orderID\");\r\n                setredireact(true)\r\n\r\n            })\r\n            .catch((err) => {\r\n                console.log(err);\r\n\r\n            })\r\n\r\n\r\n\r\n\r\n    }\r\n    const isLoading = () => {\r\n        if (loading) {\r\n            return ( <\r\n                div class = \"spinner-border text-warning\"\r\n                role = \"status\" >\r\n                <\r\n                span class = \"sr-only\" > Loading... < /span> <\r\n                /div>\r\n            )\r\n        }\r\n    }\r\n    const handleLocationError = (error) => {\r\n        switch (error.code) {\r\n            case error.PERMISSION_DENIED:\r\n                alert(\"User denied the request for Geolocation.\")\r\n                break;\r\n            case error.POSITION_UNAVAILABLE:\r\n                alert(\"Location information is unavailable.\")\r\n                break;\r\n            case error.TIMEOUT:\r\n                alert(\"The request to get user location timed out.\")\r\n                break;\r\n            case error.UNKNOWN_ERROR:\r\n                alert(\"An unknown error occurred.\")\r\n                break;\r\n            default:\r\n                alert(\"An unknown error accurder type ur address manually\");\r\n        }\r\n    }\r\n    const contQty = (product) => {\r\n        let cart = [];\r\n        let yy = [];\r\n        console.log(\"--->>> y product \", product);\r\n\r\n        let TOTOAL = 0;\r\n        if (typeof window !== undefined) {\r\n            if (localStorage.getItem(\"cart\")) {\r\n                cart = JSON.parse(localStorage.getItem(\"cart\"));\r\n                product.map((pro, I) => {\r\n                    cart.map((cpor, cI) => {\r\n                        if (cpor != null && pro === cpor.name) {\r\n                            TOTOAL = TOTOAL + 1;\r\n                        }\r\n                    })\r\n                    yy.push(TOTOAL)\r\n                    TOTOAL = 0;\r\n                })\r\n            }\r\n\r\n        }\r\n        return yy;\r\n    }\r\n\r\n\r\n    const contPrice = (product) => {\r\n        let cart = [];\r\n        let yy = [];\r\n        let curentProduct = [];\r\n        console.log(\"--->>> y product \", product);\r\n\r\n        let TOTOAL = 0;\r\n        if (typeof window !== undefined) {\r\n            if (localStorage.getItem(\"cart\")) {\r\n                cart = JSON.parse(localStorage.getItem(\"cart\"));\r\n                product.map((pro, I) => {\r\n                    cart.map((cpor, cI) => {\r\n                        if (cpor != null && pro === cpor.name) {\r\n                            TOTOAL = TOTOAL + 1;\r\n                            yy.push(cpor.price)\r\n\r\n                        }\r\n                    })\r\n                    TOTOAL = 0;\r\n                })\r\n            }\r\n\r\n        }\r\n        curentProduct = [...new Set(yy)];\r\n        return curentProduct;\r\n    }\r\n\r\n\r\n    const shoemap = () => {\r\n        if (latitude && longitude) {\r\n            const loc = { \"latitude\": latitude, \"longitude\": longitude }\r\n            getUserAddress(loc).then(res => {\r\n                    // console.log(res);\r\n                })\r\n                .catch(err => {\r\n                    // console.log(err);\r\n                })\r\n        }\r\n    }\r\n    return ( <\r\n        div >\r\n\r\n        <\r\n        h1 > COD < /h1> <\r\n        h4 > { JSON.stringify(latitude) } { JSON.stringify(longitude) } < /h4> <\r\n        div className = \"container\" > { shoemap() } <\r\n        /div> <\r\n        div className = \"container codbox\" >\r\n        <\r\n        div class = \"alert alert-primary\"\r\n        role = \"alert\" >\r\n        We are currently available in < a href = \"#\"\r\n        class = \"alert-link\" > Malumichampatti < /a>. And we can do delivery !! <\r\n        /div> <\r\n        form >\r\n        <\r\n        div class = \"form-group\" >\r\n        <\r\n        label > Your Address < /label> <\r\n        input placeholder = \"Enter the address\"\r\n        onChange = {\r\n            (e) => { locationUser(e) } }\r\n        type = \"text\"\r\n        class = \"form-control\"\r\n        required / >\r\n        <\r\n        /div> { isRedirectHome() } { isLoading() } <\r\n        button onClick = { confirmOrder }\r\n        type = \"submit\"\r\n        class = \"btn btn-primary\" > Confirm Address < /button> <\r\n        button onClick = { getGLocation }\r\n        type = \"submit\"\r\n        class = \"btn btn-primary\" > Confirm Address < /button>\r\n\r\n        <\r\n        /form>\r\n\r\n        <\r\n        /div> <\r\n        /div>\r\n    )\r\n}"]},"metadata":{},"sourceType":"module"}